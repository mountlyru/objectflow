# Пример: Загрузка документа «Ввод остатков товаров»

Пошаговое руководство по загрузке данных из Excel-файла в документ **«Ввод остатков товаров»** (1С:ERP / 1С:Комплексная автоматизация).

---

## Содержание

1. [Подготовка Excel-файла](#1-подготовка-excel-файла)
2. [Загрузка файла в систему](#2-загрузка-файла-в-систему)
3. [Выбор типа объекта](#3-выбор-типа-объекта)
4. [Настройка маппинга реквизитов шапки](#4-настройка-маппинга-реквизитов-шапки)
5. [Настройка маппинга табличной части «Товары»](#5-настройка-маппинга-табличной-части-товары)
6. [Настройка параметров загрузки](#6-настройка-параметров-загрузки)
7. [Запуск загрузки и проверка результатов](#7-запуск-загрузки-и-проверка-результатов)
8. [JSON-конфигурация настроек](#8-json-конфигурация-настроек)

---

## 1. Подготовка Excel-файла

Подготовьте файл `Ввод остатков товаров.xlsx` со следующей структурой:

| N | Код | Артикул | Номенклатура | Назначение | Характеристика | Серия | Статус указания серий | Количество | Упаковка | Ед. изм. | Цена (RUB) | Сумма (RUB) | Ставка НДС | НДС (RUB) | Сумма с НДС | Сумма (регл.) | НДС (регл) | Детализация партий | Номер ГТД / РНПТ | Сумма (ПР) | Сумма (ВР) | Резерв (регл.) | Резерв (упр.) | Склад |
|---|-----|---------|--------------|------------|----------------|-------|-----------------------|------------|----------|----------|-------------|-------------|------------|-----------|-------------|---------------|-------------|--------------------|-------------------|------------|------------|----------------|---------------|-------|
| 1 | 00-00000313 | | Лампа Gauss Filament А60 | | 12W 1200lm 2700К Е27 LED | | | 450 | | шт | 315.63 | 142033.5 | 20% | 23672.25 | 142033.5 | 118361.25 | 23672.25 | Нет | | | | | | Склад осветительных приборов |
| 1 | 00-00000313 | | Лампа Gauss Filament А60 | | 15W 1450lm 4100К Е27 LED | | | 300 | | шт | 396.0 | 118800.0 | 20% | 19800.0 | 118800.0 | 99000.0 | 19800.0 | Нет | | | | | | Склад осветительных приборов |
| 1 | 00-00000313 | | Лампа Gauss Filament А60 | | 20W 1850lm 4100К Е27 LED | | | 385 | | шт | 422.13 | 162520.05 | 20% | 27086.68 | 162520.05 | 135433.37 | 27086.67 | Нет | | | | | | Склад осветительных приборов |
| 1 | 00-00000314 | | Лампа LED ЭРА A60 | | 11W-827-E27 | | | 858 | | шт | 135.0 | 115830.0 | 20% | 19305.0 | 115830.0 | 96525.0 | 19305.0 | Нет | | | | | | Склад осветительных приборов |
| 1 | 00-00000314 | | Лампа LED ЭРА A60 | | 11W-840-E27 | | | 676 | | шт | 135.0 | 91260.0 | 20% | 15210.0 | 91260.0 | 76050.0 | 15210.0 | Нет | | | | | | Склад осветительных приборов |

> **Важно:** Данные начинаются со **2-й строки** (первая строка — заголовки). Используется **первый лист** книги Excel.

**Ключевые колонки для загрузки:**
- **Номенклатура** (колонка D) — наименование товара, поиск в справочнике «Номенклатура»
- **Характеристика** (колонка F) — характеристика номенклатуры, поиск с привязкой к владельцу
- **Количество** (колонка I) — количество единиц товара
- **Ставка НДС** (колонка N) — ставка НДС, поиск в справочнике «Ставки НДС»
- **Склад** (колонка Y) — склад хранения, поиск в справочнике «Склады»
- 
---

## 2. Настройка маппинга реквизитов шапки

Для реквизитов шапки документа настройте следующие соответствия:

### 2.1. Реквизиты, заполняемые фиксированным значением

| Реквизит | Способ заполнения | Значение |
|----------|-------------------|----------|
| Дата | Значением | `2026-02-08` |
| ОтражатьВБУиНУ | Значением | `Истина` |
| ОтражатьВОперативномУчете | Значением | `Истина` |
| ОтражатьВУУ | Значением | `Ложь` |
| ОтражатьСебестоимость | Значением | `Истина` |
| ЦенаВключаетНДС | Значением | `Истина` |

<img width="780" height="758" alt="image" src="https://github.com/user-attachments/assets/00d68872-73df-4815-ba2b-c79b6840df8c" />

### 2.2. Реквизиты, заполняемые предопределенным значением

| Реквизит | Предопределенное значение |
|----------|---------------------------|
| ВидДеятельностиНДС | Продажа облагается НДС |
| НалогообложениеНДС | Продажа облагается НДС |
| ХозяйственнаяОперация | Ввод остатков собственных товаров |

<img width="778" height="892" alt="image" src="https://github.com/user-attachments/assets/0497c906-502e-47fe-b4ca-8ddff761b687" />

### 2.3. Реквизиты, заполняемые алгоритмом

| Реквизит | Алгоритм (код на 1С) |
|----------|----------------------|
| Валюта | `Результат = Справочники.Валюты.НайтиПоНаименованию("RUB")` |
| Организация | `Результат = Справочники.Организации.НайтиПоНаименованию("ЭлектроМир")` |
| Ответственный | `Результат = Пользователи.ТекущийПользователь()` |
| Автор | `Результат = Пользователи.ТекущийПользователь()` |

<img width="763" height="837" alt="image" src="https://github.com/user-attachments/assets/d341cd06-3c8b-420e-9d45-3a846f113ed0" />

### 2.4. Реквизиты, заполняемые из файла

| Реквизит | Колонка файла | Способ поиска |
|----------|---------------|---------------|
| Склад | Склад (колонка 24) | По наименованию в справочнике «Склады» |

<img width="747" height="782" alt="image" src="https://github.com/user-attachments/assets/f269effe-5b7c-4881-a333-1e82c358d87a" />

---

## 3. Настройка маппинга табличной части «Товары»

Табличная часть **«Товары»** заполняется построчно из Excel-файла. Для каждой строки файла создается строка табличной части.
Группировка выполняется по значению из колонки "N"

<img width="1231" height="206" alt="image" src="https://github.com/user-attachments/assets/d1d4d3d9-ccb1-4d85-af8f-ba345ad10a92" />

### 3.1. Реквизиты из файла

| Реквизит ТЧ | Колонка файла | Тип данных | Способ поиска ссылки |
|--------------|---------------|------------|----------------------|
| Номенклатура | Номенклатура (колонка 3) | СправочникСсылка.Номенклатура | По наименованию |
| Характеристика | Характеристика (колонка 5) | СправочникСсылка.ХарактеристикиНоменклатуры | По наименованию + владелец (Номенклатура) |
| Количество | Количество (колонка 8) | Число(15,3) | — |
| КоличествоУпаковок | Количество (колонка 8) | Число(15,3) | — |
| СтавкаНДС | Ставка НДС (колонка 13) | СправочникСсылка.СтавкиНДС | По наименованию |

> **Обратите внимание:** Колонка «Количество» из файла используется для заполнения двух реквизитов: **Количество** и **КоличествоУпаковок**.

### 3.2. Реквизиты, заполняемые алгоритмом

| Реквизит ТЧ | Алгоритм (код на 1С) |
|--------------|----------------------|
| ИдентификаторСтроки | `Результат = Новый УникальныйИдентификатор;` |

<img width="776" height="769" alt="image" src="https://github.com/user-attachments/assets/7a0b8b9b-4dc5-483c-a836-2515c0fb1fd4" />

### 3.3. Поиск характеристики по владельцу

Для реквизита **Характеристика** настроен составной поиск:
- **Наименование** — берется из колонки «Характеристика» файла (колонка 5)
- **Владелец** — берется из маппинга реквизита «Номенклатура» (маппинг №18)

Это обеспечивает поиск характеристики именно у нужной номенклатуры.

<img width="744" height="946" alt="image" src="https://github.com/user-attachments/assets/0e8c424a-a33c-4c86-8849-41b9eb17d09d" />

---

## 4. Настройка параметров загрузки

| Параметр | Значение | Описание |
|----------|----------|----------|
| Группировка строк | По колонке **N** (колонка 0) | Строки с одинаковым номером группируются в один документ |
| Лист Excel | Первый лист (индекс 0) | — |
| Начальная строка | 2 | Пропуск строки заголовков |
| Режим обновления | Создание нового | Всегда создаются новые объекты |
| Обязательные поля | Пропускать | Строки с незаполненными обязательными полями пропускаются |
| Использовать транзакцию | Нет | Каждый документ записывается отдельно |
| Режим разработчика | Нет | — |
| Объект записыватся | Автоматически | — |

<img width="771" height="1049" alt="image" src="https://github.com/user-attachments/assets/0ee04c65-acc9-460e-be04-d99c31585102" />

Генерация происходит по кнопке
<img width="234" height="96" alt="image" src="https://github.com/user-attachments/assets/d663c34f-a03e-4800-857c-a51f4ef22aab" />

---

## 5. Запуск загрузки и проверка результатов

1. Нажмите кнопку **«Загрузить»**
2. Дождитесь завершения процесса
3. Проверьте лог загрузки — убедитесь, что все строки обработаны успешно
4. Откройте созданный документ в 1С и проверьте заполнение реквизитов

<img width="1643" height="229" alt="image" src="https://github.com/user-attachments/assets/811c543d-4556-473d-ba58-2d04a9c4914e" />

<img width="1627" height="573" alt="image" src="https://github.com/user-attachments/assets/ea596483-8f42-4660-ac01-687476c28c69" />


### Ожидаемый результат

После загрузки будет создан документ **«Ввод остатков товаров»** со следующими данными:

**Шапка документа:**
- Дата: 08.02.2026
- Организация: ЭлектроМир
- Склад: Склад осветительных приборов
- Валюта: RUB
- Хозяйственная операция: Ввод остатков собственных товаров
- Цена включает НДС: Да

**Табличная часть «Товары» (5 строк):**

| Номенклатура | Характеристика | Количество | Ставка НДС |
|-------------|----------------|------------|------------|
| Лампа Gauss Filament А60 | 12W 1200lm 2700К Е27 LED | 450 | 20% |
| Лампа Gauss Filament А60 | 15W 1450lm 4100К Е27 LED | 300 | 20% |
| Лампа Gauss Filament А60 | 20W 1850lm 4100К Е27 LED | 385 | 20% |
| Лампа LED ЭРА A60 | 11W-827-E27 | 858 | 20% |
| Лампа LED ЭРА A60 | 11W-840-E27 | 676 | 20% |

---

## Частые вопросы

### Как загрузить данные в несколько документов?

Используйте колонку группировки. В данном примере группировка настроена по колонке **N** (порядковый номер). Все строки с одинаковым номером попадут в один документ. Если вам нужно разбить данные на несколько документов — используйте колонку с уникальным идентификатором группы (например, номер партии или код склада).

### Что произойдет, если номенклатура не найдена в справочнике?

Поведение зависит от настройки **«Обязательные поля»**. В данном примере выбрано значение **«Пропускать»** — строки с ненайденной номенклатурой будут пропущены, а информация об ошибке отобразится в логе загрузки.

### Как работает поиск характеристики по владельцу?

Характеристика ищется не просто по наименованию, а с учетом владельца (номенклатуры). Это предотвращает ситуацию, когда у разных товаров есть характеристики с одинаковыми наименованиями. В маппинге указана связь: свойство «Владелец» берется из маппинга №18 (Номенклатура).

